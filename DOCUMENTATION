# aitool.json Documentation

Complete reference for the aitool.json specification.

## Table of Contents

- [Overview](#overview)
- [File Structure](#file-structure)
- [Field Reference](#field-reference)
- [Examples](#examples)
- [Best Practices](#best-practices)

---

## Overview

An aitool.json file describes a single tool that AI agents can use. It includes everything the agent needs to know: when to use it, how to call it, what to do when it fails, and how it performs.

Every file must be valid JSON and follow the schema defined in `schema/aitool-schema.json`.

---

## File Structure

### Minimal Example

```json
{
  "aitool_version": "1.0.0",
  "manifest": {
    "id": "com.company.tool",
    "name": "tool_name",
    "version": "1.0.0",
    "category": "data_retrieval"
  },
  "capabilities": {
    "primary_function": "search"
  },
  "execution": {
    "protocol": "function_call",
    "endpoint": {
      "type": "python_function",
      "module": "myapp.tools",
      "function": "tool_name"
    },
    "parameters": {
      "type": "object",
      "required": ["query"],
      "properties": {
        "query": {"type": "string"}
      }
    },
    "returns": {
      "success_schema": {
        "type": "object",
        "properties": {
          "result": {"type": "string"}
        }
      }
    }
  },
  "usage_guidance": {
    "when_to_use": [
      {
        "trigger": "User wants to do X",
        "examples": ["find X", "search for X"]
      }
    ]
  }
}
```

### Full Example

See `examples/search_database.aitool.json` for a complete example with all optional fields.

---

## Field Reference

### aitool_version (required)

**Type:** string  
**Format:** Semantic version (e.g., "1.0.0")

The version of the aitool.json spec this file uses. Always use "1.0.0" for now.

```json
"aitool_version": "1.0.0"
```

---

### manifest (required)

Metadata about the tool.

#### manifest.id (required)

**Type:** string  
**Format:** Reverse domain notation (e.g., "com.company.tool-name")

Unique identifier for this tool. Should never change.

```json
"id": "com.acme.search-products"
```

#### manifest.name (required)

**Type:** string  
**Format:** snake_case

Function name. Used when calling the tool.

```json
"name": "search_products"
```

#### manifest.version (required)

**Type:** string  
**Format:** Semantic version

Tool version. Increment when you make changes.

```json
"version": "1.2.0"
```

#### manifest.category (required)

**Type:** string  
**Options:**
- `data_retrieval` - Fetch or search data
- `data_manipulation` - Transform or process data
- `communication` - Send messages, emails
- `computation` - Calculate or analyze
- `file_operations` - Create or edit files
- `api_integration` - External API calls
- `automation` - Automate tasks
- `monitoring` - Check status or health
- `security` - Auth or permissions
- `other` - Everything else

```json
"category": "data_retrieval"
```

#### manifest.display_name (optional)

**Type:** string

Human-readable name.

```json
"display_name": "Product Search"
```

#### manifest.description (optional)

**Type:** string  
**Max length:** 500 characters

Brief description of what the tool does.

```json
"description": "Search product database for items matching a query"
```

#### manifest.tags (optional)

**Type:** array of strings

Keywords for discovery.

```json
"tags": ["search", "products", "inventory"]
```

#### manifest.provider (optional)

Contact info for the tool maintainer.

```json
"provider": {
  "name": "Acme Corp",
  "contact": "tools@acme.com",
  "support_url": "https://support.acme.com",
  "documentation_url": "https://docs.acme.com"
}
```

---

### capabilities (required)

What the tool can do.

#### capabilities.primary_function (required)

**Type:** string

One-word summary of what the tool does.

```json
"primary_function": "search"
```

#### capabilities.supported_operations (optional)

**Type:** array of strings

List of operations the tool supports.

```json
"supported_operations": ["query", "filter", "paginate"]
```

#### capabilities.idempotent (optional)

**Type:** boolean

Whether calling the tool multiple times with the same input produces the same result.

```json
"idempotent": true
```

#### capabilities.stateful (optional)

**Type:** boolean

Whether the tool maintains state between calls.

```json
"stateful": false
```

#### capabilities.requires_auth (optional)

**Type:** boolean

Whether the tool needs authentication.

```json
"requires_auth": true
```

---

### execution (required)

How to actually run the tool.

#### execution.protocol (required)

**Type:** string  
**Options:**
- `function_call` - Python/JavaScript function
- `http` - HTTP API
- `cli` - Command line tool
- `grpc` - gRPC service
- `websocket` - WebSocket connection

```json
"protocol": "function_call"
```

#### execution.endpoint (required)

Where to find the tool. Format depends on protocol.

**For function_call:**
```json
"endpoint": {
  "type": "python_function",
  "module": "myapp.tools",
  "function": "search_products"
}
```

**For http:**
```json
"endpoint": {
  "type": "http",
  "method": "POST",
  "url": "https://api.example.com/search",
  "headers": {
    "Authorization": "Bearer ${API_KEY}"
  }
}
```

**For cli:**
```json
"endpoint": {
  "type": "cli",
  "command": "search-tool",
  "args": ["--query", "${query}"]
}
```

#### execution.parameters (required)

**Type:** JSON Schema object

Defines what parameters the tool accepts. Uses standard JSON Schema format.

```json
"parameters": {
  "type": "object",
  "required": ["query"],
  "properties": {
    "query": {
      "type": "string",
      "minLength": 3,
      "maxLength": 200,
      "description": "Search query"
    },
    "limit": {
      "type": "integer",
      "minimum": 1,
      "maximum": 100,
      "default": 10
    }
  }
}
```

Common field types:
- `string` - Text
- `integer` - Whole numbers
- `number` - Decimals
- `boolean` - true/false
- `array` - Lists
- `object` - Nested structures

#### execution.returns (required)

What the tool returns.

```json
"returns": {
  "success_schema": {
    "type": "object",
    "required": ["results", "count"],
    "properties": {
      "results": {
        "type": "array",
        "items": {"type": "object"}
      },
      "count": {"type": "integer"}
    }
  },
  "success_criteria": [
    "Returns results array (may be empty)",
    "Count matches array length"
  ]
}
```

#### execution.timeout_seconds (optional)

**Type:** number

Max execution time in seconds.

```json
"timeout_seconds": 30
```

---

### usage_guidance (required)

When and how to use the tool.

#### usage_guidance.when_to_use (required)

**Type:** array of objects

Scenarios where this tool should be used.

```json
"when_to_use": [
  {
    "trigger": "User wants to find products",
    "confidence": "high",
    "examples": [
      "find red shirts",
      "search for laptops under $500",
      "what products do you have?"
    ]
  }
]
```

**confidence** can be:
- `high` - This tool is definitely the right choice
- `medium` - This tool might work
- `low` - This tool could work but isn't ideal

#### usage_guidance.when_not_to_use (optional)

**Type:** array of objects

When NOT to use this tool.

```json
"when_not_to_use": [
  {
    "scenario": "User asks about prices",
    "reason": "This database has stale pricing data",
    "alternative_tool": "com.acme.get-pricing"
  }
]
```

#### usage_guidance.best_practices (optional)

**Type:** array of strings

Tips for using the tool well.

```json
"best_practices": [
  "Be specific in queries for better results",
  "Use filters to narrow large result sets",
  "Empty results are normal, not an error"
]
```

#### usage_guidance.common_mistakes (optional)

**Type:** array of objects

Things people often get wrong.

```json
"common_mistakes": [
  {
    "mistake": "Query too vague (just 'shirts')",
    "consequence": "Returns too many results",
    "fix": "Add specifics like color, size, style"
  }
]
```

---

### error_handling (optional but recommended)

What to do when things fail.

```json
"error_handling": [
  {
    "error_type": "timeout",
    "error_code": "TimeoutError",
    "detection": "Response time > 5 seconds",
    "recovery": {
      "strategy": "retry_with_backoff",
      "max_retries": 3,
      "backoff_ms": [1000, 2000, 4000]
    }
  }
]
```

**Recovery strategies:**

- `retry` - Try again immediately
- `retry_with_backoff` - Wait longer between retries
- `wait_and_retry` - Wait fixed time then retry once
- `alternate_tool` - Use different tool
- `fail` - Give up and return error
- `prompt_user` - Ask user what to do

**Example with alternate tool:**
```json
{
  "error_type": "database_unavailable",
  "recovery": {
    "strategy": "alternate_tool",
    "fallback_tool": "com.acme.search-cache",
    "message_to_user": "Main DB down, using cache"
  }
}
```

---

### operations (optional)

Performance and operational characteristics.

```json
"operations": {
  "performance": {
    "latency_ms": {
      "p50": 50,
      "p95": 120,
      "p99": 200
    },
    "throughput_qps": 1000
  },
  "cost": {
    "tier": "low",
    "pricing": {
      "model": "per_request",
      "amount": 0.001,
      "currency": "USD"
    }
  },
  "rate_limits": {
    "requests_per_minute": 100,
    "requests_per_hour": 5000
  }
}
```

**Cost tiers:**
- `free` - No cost
- `low` - Cents per request
- `medium` - Dollars per request
- `high` - Expensive

---

### examples (optional)

Real input/output pairs.

```json
"examples": [
  {
    "name": "basic_search",
    "description": "Simple product search",
    "input": {
      "query": "red shirts",
      "limit": 5
    },
    "output": {
      "results": [...],
      "count": 3
    },
    "context": "User wants to find specific items"
  }
]
```

---

### testing (optional)

Tests to validate the tool works correctly.

```json
"testing": {
  "contract_tests": [
    {
      "name": "valid_query_returns_results",
      "input": {"query": "test", "limit": 5},
      "assertions": [
        "response.results is array",
        "response.count >= 0"
      ]
    }
  ],
  "validation_rules": [
    "Query must be at least 3 characters",
    "Limit must be between 1 and 100"
  ]
}
```

---

### composition (optional)

How this tool relates to others.

```json
"composition": {
  "dependencies": [
    {
      "tool_id": "com.acme.auth",
      "version": ">=2.0.0",
      "required": true,
      "purpose": "Authentication"
    }
  ],
  "can_compose_with": [
    {
      "tool_id": "com.acme.get-pricing",
      "pattern": "sequential",
      "description": "Search products then get prices"
    }
  ]
}
```

**Composition patterns:**
- `sequential` - Run one after another
- `parallel` - Run at same time
- `conditional` - Run based on conditions

---

### versioning (optional)

Version history and compatibility.

```json
"versioning": {
  "current_version": "1.2.0",
  "deprecated": false,
  "breaking_changes": [
    {
      "version": "1.0.0",
      "date": "2024-01-15",
      "changes": [
        "Removed 'fuzzy_match' parameter",
        "Changed 'items' to 'results' in response"
      ],
      "migration_guide": "https://docs.example.com/migration"
    }
  ],
  "compatibility": {
    "backward_compatible_with": ["1.1.x", "1.0.x"],
    "forward_compatible_with": []
  }
}
```

---

## Examples

### Simple Search Tool

```json
{
  "aitool_version": "1.0.0",
  "manifest": {
    "id": "com.example.search",
    "name": "search",
    "version": "1.0.0",
    "category": "data_retrieval"
  },
  "capabilities": {
    "primary_function": "search"
  },
  "execution": {
    "protocol": "function_call",
    "endpoint": {
      "type": "python_function",
      "module": "tools",
      "function": "search"
    },
    "parameters": {
      "type": "object",
      "required": ["query"],
      "properties": {
        "query": {"type": "string"}
      }
    },
    "returns": {
      "success_schema": {
        "type": "object",
        "properties": {
          "results": {"type": "array"}
        }
      }
    }
  },
  "usage_guidance": {
    "when_to_use": [
      {
        "trigger": "User wants to search",
        "examples": ["find X", "search for Y"]
      }
    ]
  }
}
```

### HTTP API Tool

```json
{
  "aitool_version": "1.0.0",
  "manifest": {
    "id": "com.weather.forecast",
    "name": "get_weather",
    "version": "1.0.0",
    "category": "api_integration"
  },
  "capabilities": {
    "primary_function": "weather_forecast",
    "requires_auth": true
  },
  "execution": {
    "protocol": "http",
    "endpoint": {
      "type": "http",
      "method": "GET",
      "url": "https://api.weather.com/forecast",
      "headers": {
        "Authorization": "Bearer ${API_KEY}"
      }
    },
    "parameters": {
      "type": "object",
      "required": ["location"],
      "properties": {
        "location": {"type": "string"},
        "days": {"type": "integer", "default": 3}
      }
    },
    "returns": {
      "success_schema": {
        "type": "object",
        "properties": {
          "forecast": {"type": "array"}
        }
      }
    }
  },
  "usage_guidance": {
    "when_to_use": [
      {
        "trigger": "User asks about weather",
        "examples": ["what's the weather in Paris?"]
      }
    ]
  },
  "error_handling": [
    {
      "error_type": "rate_limit",
      "recovery": {
        "strategy": "wait_and_retry",
        "wait_seconds": 60
      }
    }
  ]
}
```

---

## Best Practices

### Do's

**Be specific in triggers**
```json
"when_to_use": [
  {
    "trigger": "User wants to find products in our catalog",
    "examples": ["find red shirts", "search for laptops under $500"]
  }
]
```

**Include real examples**
```json
"examples": [
  {
    "input": {"query": "red shirts", "limit": 5},
    "output": {"results": [...], "count": 3}
  }
]
```

**Document error recovery**
```json
"error_handling": [
  {
    "error_type": "timeout",
    "recovery": {
      "strategy": "retry_with_backoff",
      "max_retries": 3
    }
  }
]
```

**Use semantic versioning**
- 1.0.0 → 1.0.1 (bug fix)
- 1.0.0 → 1.1.0 (new feature, backward compatible)
- 1.0.0 → 2.0.0 (breaking change)

### Don'ts

**Don't be vague**
```json
// Bad
"trigger": "When user needs something"

// Good
"trigger": "User wants to search product catalog"
```

**Don't skip when_not_to_use**
```json
// Bad - only saying when to use it

// Good - also saying when NOT to
"when_not_to_use": [
  {
    "scenario": "User asks about prices",
    "alternative_tool": "com.acme.get-pricing"
  }
]
```

**Don't forget validation**
```json
// Bad
"parameters": {
  "type": "object",
  "properties": {
    "query": {"type": "string"}
  }
}

// Good - with constraints
"parameters": {
  "type": "object",
  "required": ["query"],
  "properties": {
    "query": {
      "type": "string",
      "minLength": 3,
      "maxLength": 200
    }
  }
}
```

---

## Common Patterns

### Pagination

```json
"parameters": {
  "type": "object",
  "properties": {
    "limit": {
      "type": "integer",
      "minimum": 1,
      "maximum": 100,
      "default": 10
    },
    "offset": {
      "type": "integer",
      "minimum": 0,
      "default": 0
    }
  }
}
```

### Filtering

```json
"parameters": {
  "type": "object",
  "properties": {
    "filters": {
      "type": "object",
      "properties": {
        "category": {"type": "string"},
        "min_price": {"type": "number"},
        "in_stock": {"type": "boolean"}
      }
    }
  }
}
```

### Sorting

```json
"parameters": {
  "type": "object",
  "properties": {
    "sort_by": {
      "type": "string",
      "enum": ["relevance", "price", "date"],
      "default": "relevance"
    }
  }
}
```

---

## Validation

Use the CLI to check your files:

```bash
python3 cli/aitool-cli.py validate my_tool.aitool.json
```

Common validation errors:

**Missing required field:**
```
Error: 'manifest' is a required property
```
Fix: Add the manifest section.

**Invalid type:**
```
Error: 'timeout_seconds' should be number, got string
```
Fix: Remove quotes from numbers.

**Invalid enum value:**
```
Error: 'unknown' is not valid for 'category'
```
Fix: Use one of the allowed categories.

---

For more help, see `examples/` for complete working examples.
